<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Estimate Wizard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const slides = Array.from(document.querySelectorAll('.slide'));
            let current = 0;

            function showSlide(index) {
                slides.forEach((slide, i) => {
                    slide.classList.toggle('hidden', i !== index);
                });
            }

            function validate(slide) {
                const inputs = slide.querySelectorAll('input, textarea');
                for (const input of inputs) {
                    if (!input.value.trim()) {
                        return false;
                    }
                }
                return true;
            }

            function collectData() {
                const data = {};
                document.querySelectorAll('input, textarea').forEach(el => {
                    data[el.name] = el.value;
                });
                return data;
            }

            function submitData() {
                const payload = collectData();
                fetch('', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: JSON.stringify(payload)
                }).then(resp => {
                    if (resp.ok) {
                        document.getElementById('thanks').classList.remove('hidden');
                    }
                });
            }

            document.querySelectorAll('[data-next]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const slide = slides[current];
                    if (!validate(slide)) {
                        alert('Please fill out all fields');
                        return;
                    }
                    current += 1;
                    if (current >= slides.length) {
                        submitData();
                    } else {
                        showSlide(current);
                    }
                });
            });

            showSlide(current);
        });
    </script>
</head>
<body class="min-h-screen bg-green-50 flex items-center justify-center p-4">
    <form>
        {% csrf_token %}
        <div class="slide">
            <input type="number" name="lot_size_acres" class="border p-2 block mb-2" placeholder="Lot size (acres)" />
            <input type="text" name="address" class="border p-2 block" placeholder="Address" />
            <button type="button" data-next class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2">Next</button>
        </div>
        <div class="slide hidden">
            <textarea name="current_property"
                      class="border p-2 w-full"
                      placeholder="Describe current property"></textarea>
            <button type="button" data-next class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2">Next</button>
        </div>
        <div class="slide hidden">
            <textarea name="property_goal"
                      class="border p-2 w-full"
                      placeholder="What's your property goal?"></textarea>
            <button type="button" data-next class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2">Next</button>
        </div>
        <div class="slide hidden">
            <textarea name="investment_commitment"
                      class="border p-2 w-full"
                      placeholder="Investment commitment"></textarea>
            <button type="button" data-next class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2">Next</button>
        </div>
        <div class="slide hidden">
            <textarea name="excitement_notes"
                      class="border p-2 w-full"
                      placeholder="What excites you about this project?"></textarea>
            <button type="button" data-next class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2">Submit</button>
        </div>
    </form>
    <div id="thanks" class="hidden">Thank you for your submission!</div>
</body>
</html>
